---
export interface FAQEntry {
  question: string;
  answer: string;
}
export interface Props {
  entries: FAQEntry[];
}
const { entries } = Astro.props;

// Usuwamy tagi HTML z odpowiedzi, aby JSON-LD byÅ‚ czystym tekstem
const stripHtml = (html: string) => html.replace(/<[^>]*>?/gm, '');

// Ensure entries is an array and filter out invalid entries
const validEntries = Array.isArray(entries) ? entries.filter(entry => 
  entry && 
  typeof entry.question === 'string' && 
  entry.question.trim() !== '' &&
  typeof entry.answer === 'string' && 
  entry.answer.trim() !== ''
) : [];

const faqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": validEntries.length > 0 
    ? validEntries.map(entry => ({
        "@type": "Question",
        "name": entry.question.trim(),
        "acceptedAnswer": {
          "@type": "Answer",
          "text": stripHtml(entry.answer).trim()
        }
      }))
    : []
};
---
{validEntries.length > 0 && (
  <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />
)}
