---
import { getCollection } from "astro:content";
import ShortUniqueId from "short-unique-id";
import ProductBuiltBy from "../components/product/ProductBuiltBy.astro";
import { ProductFeature } from "../components/product/ProductFeature/ProductFeature";
import ProductLayout from "../layouts/ProductLayout.astro";
import ProductSection from "../layouts/ProductSection.astro";

const clientFeatures = (await getCollection("client-features")).sort(
  (f1, f2) => f1.data.order - f2.data.order,
);

const uid = new ShortUniqueId({ length: 12 });

const svgId = (): string => {
  return `svg-${uid.rnd()}`;
};

const matrixIconId = svgId();
---

<ProductLayout>
  <ProductSection padding={"small"}>
    <div class="product-features">
      {
        clientFeatures.map(async (f) => {
          const { Content } = await f.render();
          return (
            <ProductFeature title={f.data.title} client:load>
              <Content />
            </ProductFeature>
          );
        })
      }
    </div>
  </ProductSection>
  <ProductSection padding="large">
    <section id="instances">
      <div class="top">
        <p>Features</p>
      </div>
      <div class="image-with-title">
        <div class="description">
          <div class="title">
            <p>Multiple instances & locations</p>
          </div>
          <p class="content">
            When combining with defguard VPN & SSO you can have multiple defguard
            instances (installations) and multiple Locations (VPN tunnels) in one client!
            If you are an admin/devops - all your customers (instances) and all their
            tunnels (locations) can be in one place!
          </p>
        </div>
        <div class="image-container"></div>
      </div>
    </section>
  </ProductSection>
  <ProductSection padding="large" dark>
    <section id="vpn">
      <div class="top">
        <h2>Enterprise VPN & SSO</h2>
        <p>
          To get most features out of your Wireguard VPN you may consider implementing
          defguard VPN & SSO - which has a lot of unique features dedicated for
          Enterprises, organisations or individuals focused on privacy and security,
          including:
        </p>
      </div>
      <div class="image-with-title">
        <div class="description">
          <div class="title">
            <p>Site-to-Site & Roadwarrior</p>
          </div>
        </div>
        <div class="image-container"></div>
      </div>
    </section>
  </ProductSection>
  <ProductBuiltBy />
  <ProductSection dark padding="large">
    <section id="matrix">
      <h2>Join the conversation</h2>
      <div class="content">
        <div class="matrix-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="48"
            height="48"
            viewBox="0 0 48 48"
            fill="none"
          >
            <g clip-path={`url(#${matrixIconId})`}>
              <path
                d="M1.40467 1.09862V46.9014H4.69752V48H0.142456V0H4.69602V1.09862H1.40467ZM15.7096 15.6193V17.9366H15.7756C16.3527 17.0905 17.1162 16.3881 18.0073 15.8834C18.8778 15.3987 19.8759 15.1555 20.9985 15.1555C22.0791 15.1555 23.0652 15.3656 23.9582 15.7859C24.8512 16.2046 25.5296 16.943 25.9918 18.0026C26.4991 17.2522 27.1865 16.5903 28.0585 16.017C28.929 15.4422 29.9586 15.1555 31.1502 15.1555C32.0537 15.1555 32.8912 15.2666 33.6627 15.4857C34.4341 15.7078 35.0945 16.0605 35.6468 16.5468C36.1961 17.0316 36.6268 17.6664 36.936 18.4499C37.2437 19.2333 37.3983 20.1758 37.3983 21.282V32.7379H32.7051V23.0365C32.7051 22.4616 32.6826 21.9213 32.6391 21.4125C32.6076 20.9515 32.4841 20.5014 32.2759 20.0888C32.076 19.7124 31.7717 19.4017 31.3994 19.1943C31.0137 18.9752 30.4899 18.8641 29.828 18.8641C29.1676 18.8641 28.6333 18.9917 28.2251 19.2438C27.8169 19.499 27.4972 19.8292 27.2661 20.2374C27.0272 20.6686 26.8705 21.1403 26.8038 21.6287C26.7258 22.1493 26.6867 22.6751 26.6867 23.2015V32.7379H21.9921V23.1355C21.9921 22.6282 21.9816 22.1254 21.9606 21.6287C21.9435 21.1579 21.8482 20.6933 21.6784 20.2539C21.5164 19.8387 21.2275 19.4853 20.8529 19.2438C20.4657 18.9917 19.8984 18.8641 19.1495 18.8641C18.8521 18.8766 18.5576 18.9271 18.273 19.0142C17.8852 19.1259 17.5249 19.3171 17.2149 19.5755C16.8727 19.8517 16.5815 20.2494 16.3384 20.7672C16.0968 21.2865 15.9752 21.9649 15.9752 22.8038V32.7379H11.2791V15.6193H15.7096ZM46.7417 46.9014V1.09862H43.4488V0H48.0039V48H43.4488V46.9014H46.7417Z"
                style={{ fill: "var(--text-body-primary)" }}></path>
            </g>
            <defs>
              <clipPath id={matrixIconId}>
                <rect width="48" height="48" style={{ fill: "var(--text-body-primary)" }}
                ></rect>
              </clipPath>
            </defs>
          </svg>
        </div>
        <p>
          <!-- FIXME: Source link from data -->
          Matrix: <a href="https://matrix.to/#/#defguard:teonite.com"
            >#defguard:teonite.com</a
          >
        </p>
      </div>
    </section>
  </ProductSection>
</ProductLayout>

<style lang="scss">
  #matrix {
    width: 100%;

    h2 {
      @include typography(section);
      text-align: left;
      padding-bottom: 20px;
    }

    .content {
      width: 100%;
      display: flex;
      flex-flow: row;
      column-gap: 20px;
      align-items: center;
      justify-content: flex-start;

      p {
        @include typography(paragraph);
        a {
          @include typography(paragraph);
        }
      }
    }
  }
  #instances {
    width: 100%;

    & > .top {
      width: 100%;
      padding-bottom: 8px;

      p {
        @include typography(h3);
      }
    }

    // FIXME: Remove this after adding proper images
    & > .image-with-title {
      min-height: 390px;
    }
  }

  #vpn {
    .top {
      padding-bottom: 50px;
      h2 {
        @include typography(section);
      }
      p {
        @include typography(paragraph);
      }
    }
    & > .image-with-title {
      min-height: 390px;
    }
  }

  .image-with-title {
    width: 100%;
    display: grid;
    grid-template-columns: 1fr 1fr;
    align-items: center;
    justify-content: center;
    column-gap: 25px;
    row-gap: 50px;

    & > * {
      width: 100%;
    }

    .description {
      display: flex;
      flex-flow: column;
      row-gap: 28px;

      .title {
        width: 100%;
        display: flex;
        flex-flow: row;
        align-items: flex-start;
        justify-content: flex-start;
        min-height: 70px;
        box-sizing: border-box;
        border-bottom: 1px solid var(--text-body-primary);
        padding-bottom: 5px;
      }
      .content {
        @include typography(paragraph);
      }
    }

    // FIXME: Remove this after adding proper images
    .image-container {
      width: 100%;
      height: 100%;
      content: " ";
      display: block;
      border: 0 solid transparent;
      box-shadow: var(--box-shadow);
      border-radius: 8px;
    }
  }
</style>
