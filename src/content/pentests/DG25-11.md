---
title: "DG25-11: Improper handling of user-provided input leads to panic"
severity: Info
cvss_string: "/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:N"
issue_link: https://github.com/DefGuard/defguard/issues/1552

---

### Technical details

1.  While sending an enrollment e-mail, code tries to unwrap subject: settings.enrollment_welcome_email_subject.clone().
    However, this value can be None.

2.  Set enrollment_welcome_email_subject to None, by setting it to null:

**Request:**\
\
**PUT** /api/v1/settings HTTP/2\
**Host:** defguard.dvpnsec.net\
**Cookie:** defguard_session=rxjGcZckXXvXS8ec0Uhj86d6\
\[\...\]\
\
\"enrollment_use_welcome_message_as_email\":false,\"enrollment_vpn_step_optional\":true,\"enrollment_welcome_email\":\"Dear
{\[\...\]\",\"enrollment_welcome_email_subject\":null,\"enrollment_welcome_message\":
\[\...\]\
\
\
**Response:**\
\
**HTTP/2** 200 OK\
**Alt-Svc:** h3=\":443\"; ma=2592000\
**Content-Type:** application/json\
**Date:** Wed, 06 Aug 2025 10:47:07 GMT\
**Server:** Caddy\
**X-Defguard-Version:** 1.5.0-a29ac10\
**Content-Length:** 4\
\
null

In the following request, enrollment_use_welcome_message_as_email has to
be set to false and enrollment_welcome_email_subject has to be set to
null.

1.  Start the enrollment process.

2.  During the last step (before sending e-mail to the enrolled user),
    below request throws 500:

**Request:**\
\
**POST** /api/v1/enrollment/activate_user HTTP/2\
**Host:** defguard-enroll.dvpnsec.net\
\[\...\]\
\
{\"password\":\"Test123!\"}\
\
\
**Response:**\
\
**HTTP/2** 500 Internal Server Error\
**Alt-Svc:** h3=\":443\"; ma=2592000\
**Content-Type:** application/json\
**Date:** Wed, 06 Aug 2025 10:47:55 GMT\
**Server:** Caddy\
**Content-Length:** 33\
\
{\"error\":\"Internal server error\"}

and server panics:

```sh
root@defguard: ~# docker logs -f  --tail 10 47ef471e760c 
 [ ... ] 
2025-08-06T10:47:50.577684Z DEBUG run_grpc_bidi_stream:activate_user:
defguard_core::grpc::enrollment: Retriving settings to send welcome
email ... 
2025-08-06T10:47:50.577698Z DEBUG run_grpc_bidi_stream:activate_user:
defguard_core::grpc::enrollment: Successfully retrived settings. 
2025-08-06T10:47:50.577705Z DEBUG run_grpc_bidi_stream:activate_user:
defguard_core::grpc::enrollment: Try to send welcome email ... 
2025-08-06T10:47:50.577711Z DEBUG run_grpc_bidi_stream:activate_user:
defguard_core::grpc::enrollment: Sending welcome mail to testtesttest 
 
thread  'main ' panicked at
/build/crates/defguard_core/src/grpc/enrollment.rs:902:72: 
called  `Option::unwrap() ` on a  `None ` value 
note: run with  `RUST_BACKTRACE=1 ` environment variable to display a
backtrace```
