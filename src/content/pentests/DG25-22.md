---
title: "DG25-22: OpenID apps do not respect scope"
severity: Medium
cvss_score: 4.3
cvss_string: "/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N"
issue_link: https://github.com/DefGuard/defguard/issues/1519
status: Completed
---

### Technical details

OpenID app openid123 has been assigned only phone scope:

**Request:**\
\
**GET** /api/v1/oauth HTTP/2\
**Host:** defguard.dvpnsec.net\
**Cookie:** defguard_session=KENMUulcmfVkD0W8MZjN4Rjw\
\
\
**Response:**\
\
**HTTP/2** 200 OK\
**Alt-Svc:** h3=\":443\"; ma=2592000\
**Content-Type:** application/json\
**Date:** Mon, 11 Aug 2025 11:26:20 GMT\
\[\...\]\

```json
{
  "client_id ": "9szvHNlxY6R3jvbX ",
  "client_secret ": "SHyMugRCmiTkLdo1xtV5IwgrY1dKoHpN ",
  "enabled ": true,
  "id ": 8,
  "name ": "openid123 ",
  "redirect_uri ": [
    "https://isec.pl "
  ],
  "scope ": [
    "phone "
  ]
}
[ ... ]
```

This implies, that whenever user would try to authorize with more
extensive scope - oAuth flow will not let them in:

**Request:**\
\
**POST**
`/api/v1/oauth/authorize?scope=profile&response_type=code&client_id=9szvHNlxY6R3jvbX&redirect_uri=https%3A%2F%2Fisec.pl&state=1&nonce=1&allow=true`
HTTP/2\
**Host:** defguard.dvpnsec.net\
**Cookie:** defguard_session=0i1uyyokye6n58A0mSLs1VQ7\
\
\
**Response:**\
\
**HTTP/2** 302 Found\
**Alt-Svc:** h3=\":443\"; ma=2592000\
**Date:** Mon, 11 Aug 2025 11:28:31 GMT\
**Location:** `https://isec.pl/?error=invalid_scope&state=1`\
**Server:** Caddy\
**Content-Length:** 0

The only acceptable scope is phone. Moreover, during the first
authorization - user is being informed, that application wants to access
only their phone data:

**Request:**\
\
**POST**
`/api/v1/oauth/authorize?scope=phone&response_type=code&client_id=9szvHNlxY6R3jvbX&redirect_uri=https%3A%2F%2Fisec.pl&state=1&nonce=1&allow=true`
HTTP/2\
**Host:** defguard.dvpnsec.net\
**Cookie:** defguard_session=0i1uyyokye6n58A0mSLs1VQ7\
\
\
**Response:**\
\
**HTTP/2** 302 Found\
**Alt-Svc:** h3=\":443\"; ma=2592000\
**Date:** Mon, 11 Aug 2025 11:29:40 GMT\
**Location:** `https://isec.pl/?code=xoenjJby84EDEyKFsMRVnqEs&state=1`\
**Server:** Caddy\
**Content-Length:** 0

**Request:**\
\
**POST** /api/v1/oauth/token HTTP/2\
**Host:** defguard.dvpnsec.net\
**Content-Length:** 163\
**Content-Type:** application/x-www-form-urlencoded\
\
grant_type=authorization_code&redirect_uri=`https://isec.pl&code=xoenjJby84EDEyKFsMRVnqEs&client_id=9szvHNlxY6R3jvbX&client_secret=SHyMugRCmiTkLdo1xtV5IwgrY1dKoHpN&`\
\
\
**Response:**\
\
**HTTP/2** 200 OK\
**Alt-Svc:** h3=\":443\"; ma=2592000\
**Content-Type:** application/json\
**Date:** Mon, 11 Aug 2025 11:29:52 GMT\
**Server:** Caddy\
**X-Defguard-Version:** 1.5.0-a29ac10\
**Content-Length:** 124\
\
{\"access_token\":\"5CVW4Yoj5BdExPm4SyAXttu4\",\"id_token\":null,\"refresh_token\":\"L4WO6BVJqMKtAYw1nTvyf3kR\",\"token_type\":\"bearer\"}

However, the access token generated for phone scope only, has extensive
access to user e-mail, name and surname - even though those scope were
explicitly not enabled on the OpenID app.

**Request:**\
\
**GET** /api/v1/oauth/userinfo HTTP/2\
**Host:** defguard.dvpnsec.net\
**Authorization:** Bearer 5CVW4Yoj5BdExPm4SyAXttu4\
\
\
**Response:**\
\
**HTTP/2** 200 OK\
**Alt-Svc:** h3=\":443\"; ma=2592000\
**Content-Type:** application/json\
**Date:** Mon, 11 Aug 2025 11:31:47 GMT\
**Server:** Caddy\
**X-Defguard-Version:** 1.5.0-a29ac10\
**Content-Length:** 156\


```json
{
  "email ": "phtest2+fdsfsdfsdfdsfds@isec.pl ",
  "family_name ": "A ",
  "given_name ": "A ",
  "name ": "AA ",
  "phone_number ": "123123 ",
  "preferred_username ": "user ",
  "sub ": "user"
}
```